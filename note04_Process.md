【Docker】Amazon Linux のコンテナ（AWS公式）を使って環境構築したら、EC2 デプロイのアプリは幸せになれるんじゃ無いかと思ったが、見事に頓挫した
____________________________

こんな環境で開発していました。


## 【 環境 】
ローカルの開発環境は Docker コンテナを使う。  
Docker composer を使い、PHP・Node.js・MySQL・Nginx・Redis が動いている。  
フレームワークは Laravel と Vue.js。  

Webアプリケーションは EC2 にデプロイ。  
EC2 インスタンス内で、Laravel と Vue.js が動くようにする。  

ED2 は２台用意し、ロードバランサで負荷を分散。  

その他の AWS のリソースは、VPC・Route 53・RDS・ElastiCache といったサービスを使用した、ごく普通の構成。  

本番環境・ステージング環境・開発環境と、同環境を３つ用意。  

## EC2 に実施する内容
EC2 には PHPおよび各種PHPモジュール、Composer でインストールできないモジュールについては個別にインストール。  
あとは Node.js や Nginx、git や aws cli といった、実行環境を用意するために必要なツールを入れていく。  

EC2 を１つ１つにアクセスして手作業でやるのが面倒だったので、シェルスクリプトを用意して、コマンド一発で環境が整うようにしたい。  

当初は Ansible で構成管理をしてみようかと思ったのですが、想像以上にツラかったので、シェルスクリプトに落ち着きました。  

その時の記録がこちら。  
[Ansible って結構ツラいんじゃないかと思った話](https://kaki-note-02.netlify.app/2022/04/19/)  

## Amazon Linux の公式 Docker 
ちなみに、EC2 インスタンスを起動して色々実験すると、ハマッた時間の分だけ課金されるのが嫌だったので、Vagrant でローカルに Amazon Linux を起動して、その中で実験しました。  
もしかしたら、EC2 上で実行すると、また違った結果が得られるかもしれません。  




https://hub.docker.com/_/amazonlinux



## 1コンテナ複数プロセスはやめておいた方が良い話
https://qiita.com/kazurego7/items/57f5fb80b4783b7633a1


コンテナ プロセス




